<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>ã‚¦ã‚¯ãƒ¬ãƒ¬ã§ã‚ãã¼ã†</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&family=Zen+Maru+Gothic:wght@700;900&display=swap" rel="stylesheet">

<style>
  :root {
    --vh: 1vh;
  }
  
  html, body {
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    overflow: hidden;
    position: fixed;
    font-family: "Mochiy Pop One", "Zen Maru Gothic", sans-serif;
    /* é®®ã‚„ã‹ãªãƒˆãƒ­ãƒ”ã‚«ãƒ«ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
    background: linear-gradient(180deg, #4facfe 0%, #00f2fe 50%, #ffd194 100%);
    user-select: none;
  }

  /* é›²ã®ã‚ˆã†ãªèƒŒæ™¯è£…é£¾ï¼ˆå‹•ãï¼‰ */
  body::before {
    content: ""; position: absolute; inset: 0;
    background-image: 
      radial-gradient(circle at 20% 20%, rgba(255,255,255,0.4) 0, transparent 200px),
      radial-gradient(circle at 80% 40%, rgba(255,255,255,0.3) 0, transparent 150px);
    animation: cloudMove 20s ease-in-out infinite alternate;
    pointer-events: none;
  }
  @keyframes cloudMove { from{transform:translateY(0);} to{transform:translateY(-20px);} }

  /* === ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ === */
  .app-container {
    position: absolute; inset: 0;
    display: flex; flex-direction: column;
    align-items: center; justify-content: space-between;
    padding: env(safe-area-inset-top) 20px 20px 20px;
    z-index: 10;
  }

  /* === ã‚¿ã‚¤ãƒˆãƒ«ãƒ­ã‚´ === */
  .title-area {
    margin-top: 2vh;
    margin-bottom: 6px;
    text-align: center;
    position: relative;
    z-index: 20;
    filter: drop-shadow(0 4px 0 rgba(0,0,0,0.1));
  }
  
  .game-title {
    font-size: clamp(32px, 7vw, 64px);
    margin: 0;
    /* æ–‡å­—è‰²ã‚’æ¿ƒã„ã‚ªãƒ¬ãƒ³ã‚¸ã€ãƒ•ãƒã‚’ç™½ãå¤ªãã—ã¦èª­ã¿ã‚„ã™ã */
    color: #FF6B00; 
    -webkit-text-stroke: 6px #ffffff;
    paint-order: stroke fill;
    /* ãƒ†ã‚­ã‚¹ãƒˆã‚·ãƒ£ãƒ‰ã‚¦ã§ç«‹ä½“æ„Ÿ */
    text-shadow: 4px 4px 0 rgba(0,0,0,0.1);
    transform: rotate(-2deg);
    animation: titleFloat 3s ease-in-out infinite;
  }
  .sub-title {
    display: block;
    margin-top: -2px;
    margin-bottom: 10px;
    font-size: clamp(14px, 2vw, 18px);
    color: #00897B;
    background: rgba(255,255,255,0.9);
    padding: 4px 16px;
    border-radius: 20px;
    display: inline-block;
    font-weight: 900;
    box-shadow: 0 4px 0 rgba(0,0,0,0.1);
  }

  @keyframes titleFloat {
    0%, 100% { transform: rotate(-2deg) translateY(0); }
    50% { transform: rotate(2deg) translateY(-8px); }
  }

  /* === èƒŒæ™¯ã‚¤ãƒ©ã‚¹ãƒˆï¼ˆã‚¦ã‚¯ãƒ¬ãƒ¬ã¨ãƒ¤ã‚·ã®æœ¨ï¼‰ === */
  /* ãƒœã‚¿ãƒ³ã®é‚ªé­”ã«ãªã‚‰ãªã„ã‚ˆã†ã€ä¸­å¤®å¥¥ã«é…ç½® */
  .center-illustration {
    position: absolute;
    top: 55%; left: 50%;
    transform: translate(-50%, -50%);
    width: min(800px, 90vw);
    height: min(600px, 70vh);
    z-index: -1; /* ãƒœã‚¿ãƒ³ã®å¾Œã‚ */
    opacity: 1; /* ã¯ã£ãã‚Šè¦‹ã›ã‚‹ */
    pointer-events: none;
  }
  /* ã‚¤ãƒ©ã‚¹ãƒˆå…¨ä½“ã‚’å°‘ã—ã‚†ã‚‰ã‚†ã‚‰ã•ã›ã‚‹ */
  .center-illustration svg {
    width: 100%; height: 100%;
    animation: illustrationSway 6s ease-in-out infinite;
    transform-origin: center bottom;
  }
  @keyframes illustrationSway {
    0%,100%{ transform: rotate(-2.0deg) translateY(0); }
    50%{ transform: rotate(2.4deg) translateY(-5px); }
  }


  /* === ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ï¼ˆå·¦å³ã«é…ç½®ï¼‰ === */
  .menu-row {
    display: flex;
    gap: clamp(180px, 30vw, 400px); /* ã‚¦ã‚¯ãƒ¬ãƒ¬ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«é–“éš”ã‚’ã‚ã‘ã‚‹ */
    align-items: center;
    justify-content: center;
    width: 100%;
    margin-bottom: 4vh;
  }
  
  /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ï¼šç”»é¢ãŒç‹­ã„ã¨ãã¯é–“éš”ã‚’ç‹­ã‚ã‚‹ */
  @media (max-width: 700px) {
    .menu-row { gap: 20px; }
    .center-illustration { opacity: 0.6; transform: translate(-50%, -50%) scale(0.9); } /* ã‚¹ãƒãƒ›ãªã‚‰å°‘ã—è–„ãã—ã¦ãƒœã‚¿ãƒ³å„ªå…ˆ */
  }

  /* ã·ã£ãã‚Šãƒœã‚¿ãƒ³ */
  .play-btn {
    position: relative;
    width: min(220px, 30vw);
    padding: 12px 10px;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 24px;
    border: 3px solid #fff;
    box-shadow: 
      0 10px 0 rgba(0,0,0,0.1), /* åšã¿ */
      0 20px 30px rgba(0,0,0,0.15); /* å½± */
    text-align: center;
    cursor: pointer;
    transition: transform 0.1s;
    text-decoration: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 0.92;
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(2px);
  }

  .play-btn:active {
    transform: translateY(6px);
    box-shadow: 0 4px 0 rgba(0,0,0,0.1), 0 10px 15px rgba(0,0,0,0.1);
  }

  /* ãƒœã‚¿ãƒ³ã”ã¨ã®è‰² */
  .btn-tap { background: linear-gradient(135deg, #FF9A9E 0%, #FECFEF 100%); }
  .btn-uke { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }

  .btn-icon { font-size: 32px; margin-bottom: 4px; display: block; filter: drop-shadow(0 2px 0 rgba(0,0,0,0.2)); }
  .btn-title { font-size: clamp(16px, 2.5vw, 22px); color: #fff; text-shadow: 1px 1px 0 rgba(0,0,0,0.2); margin: 0; line-height: 1.2; }
  .btn-desc { font-size: 11px; color: rgba(255,255,255,0.95); font-weight: 900; margin-top: 4px; display: block; }


  /* === å…ˆç”Ÿï¼ˆã‚¬ã‚¤ãƒ‰ï¼‰ === */
/* ã‚¿ã‚¤ãƒˆãƒ«ã¨è¢«ã‚‰ãªã„ã‚ˆã†ã«ã€ä¸Šã‹ã‚‰ã®å›ºå®šä½ç½®ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ï¼‰ã«é…ç½® */
.guide-bubble {
top: clamp(138px, 26vh, 210px); /* ç”»é¢ã‚µã‚¤ã‚ºã«å¿œã˜ã¦ä¸Šä¸‹ */

  background: #fff;
  padding: 10px 22px;
  border-radius: 50px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.15);
  display: flex;
  align-items: center;
  gap: 10px;
  z-index: 25; /* ã‚¿ã‚¤ãƒˆãƒ«ã‚ˆã‚Šæ‰‹å‰ã§å¯èª­ */
  /* animation removed: JSãŒtransformã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ */
  animation: none;

  position: fixed;
  left: 50%;
  top: 0;
  transform: translate(-50%, 0) scale(1);
  max-width: min(92vw, 420px);
  pointer-events: none;
}
/* ã‚¹ãƒãƒ›ã§é«˜ã•ãŒä½ã„æ™‚ã¯ã€ã•ã‚‰ã«å°‘ã—ä¸‹ã¸ */
.guide-bubble .bunny { font-size: 26px; }
.guide-bubble .text  { font-size: 15px; font-weight: 900; color: #555; }
.guide-bubble::after {
  content: ""; position: absolute;
  bottom: -8px; left: var(--tail-left, 50%); transform: translateX(-50%);
  border-width: 8px 8px 0; border-style: solid;
  border-color: #fff transparent transparent transparent;
}

@keyframes popIn {
  from { transform: translate(-50%, -14px) scale(0.6); opacity: 0; }
  to   { transform: translate(-50%, 0)      scale(1);   opacity: 1; }
}



  /* === ãƒšãƒ¼ã‚¸é·ç§» & æ¨ªç”»é¢ãƒ­ãƒƒã‚¯ (ç¶­æŒ) === */
  #pageFlip {
    position: fixed; inset: 0; z-index: 9999; display: none; background: #fff;
  }
  #pageFlip.run { display: block; animation: fadeOut 0.3s forwards; }
  @keyframes fadeOut { from{opacity:0;} to{opacity:1;} }

  #landscapeLock {
    position: fixed; inset: 0; display: none; z-index: 99999;
    background: rgba(40,40,40,0.95); color: #fff;
    align-items: center; justify-content: center; flex-direction: column;
  }
  body.needLandscape #landscapeLock { display: flex; }


  /* ã‚»ãƒªãƒ•åˆ‡æ›¿ï¼ˆãƒ•ã‚§ãƒ¼ãƒ‰ï¼‰ */
  .guide-bubble{
    transition: opacity .22s ease, transform .22s ease;
  }
  .guide-bubble.fade{
    opacity: 0;
  }

  /* === POINT_TO_BUTTON v1: ã‚»ãƒªãƒ•ãŒã©ã£ã¡ã®ãƒœã‚¿ãƒ³ã‹åˆ†ã‹ã‚‹ã‚ˆã†ã« === */
  .guide-bubble.point-left { left: 33%; }
  .guide-bubble.point-right{ left: 67%; }
  .guide-bubble.point-center{ left: var(--tail-left, 50%); }
  .guide-bubble.point-left::after { left: 30%; }
  .guide-bubble.point-right::after{ left: 70%; }
  .guide-bubble.point-center::after{ left: var(--tail-left, 50%); }

  /* ã©ã£ã¡ã®ãƒœã‚¿ãƒ³ã‹â€œå…‰ã‚‰ã›ã‚‹â€ */
  .play-btn.hint{
    animation: hintPulse 1.15s ease-in-out infinite;
  }
  @keyframes hintPulse{
    0%,100%{
      box-shadow:
        0 10px 0 rgba(0,0,0,0.10),
        0 20px 30px rgba(0,0,0,0.15);
    }
    50%{
      box-shadow:
        0 10px 0 rgba(0,0,0,0.10),
        0 20px 30px rgba(0,0,0,0.15),
        0 0 0 7px rgba(255,255,255,0.55),
        0 0 26px rgba(255,255,255,0.55);
    }
  }
50%    { transform: translateZ(0) scale(1.03); }
  }

  /* ç”»é¢ãŒä½ã„ã¨ãã¯ã€ã•ã‚‰ã«å°‘ã—ä¸‹ã¸ï¼ˆè¢«ã‚Šé˜²æ­¢ï¼‰ */
  @media (max-height: 430px){
    .guide-bubble{ top: clamp(130px, 30vh, 230px); }
  }

  /* === BUBBLE_ANCHOR_V2: ç«¯æœ«å·®ã§å¹ãå‡ºã—ãŒé›¢ã‚Œãªã„ã‚ˆã†ã€ãƒœã‚¿ãƒ³åŸºæº–ã§é…ç½®ï¼ˆiPadå¯¾å¿œï¼‰ === */
  .guide-bubble{
    will-change: transform, top, left;
  }
  .guide-bubble.tail-up::after{
    top: -8px;
    bottom: auto;
    border-width: 0 8px 8px;
    border-style: solid;
    border-color: transparent transparent #fff;
  }

  /* === BUBBLE_ANCHOR_V3: ãƒœã‚¿ãƒ³åŸºæº–ï¼‹è¡çªå›é¿ï¼ˆiPhone/iPad/PCã§åŒã˜æ„Ÿã˜ï¼‰ === */
  .guide-bubble{
    will-change: transform, top, left;
  }
  .guide-bubble.tail-up::after{
    top: -8px;
    bottom: auto;
    border-width: 0 8px 8px;
    border-style: solid;
    border-color: transparent transparent #fff;
  }
  /* ä½ã„ç”»é¢ã§ã¯å°‘ã—ã ã‘å°ã•ãã—ã¦è¢«ã‚Šå›é¿ */
  @media (max-height: 420px){
    .guide-bubble{ transform: translate(-50%, 0) scale(0.94); }
  }

  /* === BUBBLE_ANCHOR_V4: è¢«ã‚Šå›é¿ï¼ˆå¹ãå‡ºã—ã¯â€œãƒœã‚¿ãƒ³ã®ä¸Šâ€ã«åŸºæœ¬é…ç½®ï¼‰ === */
  .guide-bubble.tail-up::after{
    top: -8px;
    bottom: auto;
    border-width: 0 8px 8px;
    border-style: solid;
    border-color: transparent transparent #fff;
  }

  /* === BUBBLE_ANCHOR_V5: â€œå¸¯â€ã«åã‚ã‚‹ï¼‹ç¸®å°ã§è¢«ã‚Šé˜²æ­¢ï¼ˆiPhone/iPad/PCçµ±ä¸€ï¼‰ === */
  .guide-bubble{
    will-change: transform, top, left;
  }
  .guide-bubble{
    /* translate ã¯JSã§å…¥ã‚Œã‚‹ã€‚scale ã¯ var ã§åˆ¶å¾¡ */
    --bubble-scale: 1;
  }
  .guide-bubble.tail-up::after{
    top: -8px;
    bottom: auto;
    border-width: 0 8px 8px;
    border-style: solid;
    border-color: transparent transparent #fff;
  }


  /* VER_BADGE */
  .ver-badge{
    position: absolute;
    right: 10px;
    bottom: 10px;
    z-index: 40;
    padding: 6px 10px;
    border-radius: 999px;
    background: rgba(0,0,0,0.38);
    color: #fff;
    font-weight: 900;
    font-size: 12px;
    letter-spacing: .02em;
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
  }
  .guide-bubble{ max-width: min(82vw, 520px); }
  .guide-bubble .text{ max-width: min(62vw, 380px); }

/* BUBBLE_V16_TEXT */
.guide-bubble .text{ white-space: nowrap; }
@media (max-width: 420px){
  .guide-bubble .text{ white-space: normal; }
}

/* BTN_ANIM_V17: ã‚³ãƒ¡ãƒ³ãƒˆã«åˆã‚ã›ã¦ãƒœã‚¿ãƒ³ã‚’â€œæ¿€ã—ãâ€å‹•ã‹ã™ */
@keyframes btnBounceTapToCenter{
  0%   { transform: translate3d(0,0,0) scale(1); }
  30%  { transform: translate3d(34px,-12px,0) scale(1.10); }
  55%  { transform: translate3d(20px,-8px,0) scale(1.06); }
  100% { transform: translate3d(0,0,0) scale(1); }
}
@keyframes btnBounceUkeToCenter{
  0%   { transform: translate3d(0,0,0) scale(1); }
  30%  { transform: translate3d(-34px,-12px,0) scale(1.10); }
  55%  { transform: translate3d(-20px,-8px,0) scale(1.06); }
  100% { transform: translate3d(0,0,0) scale(1); }
}
@keyframes btnBounceUp{
  0%   { transform: translate3d(0,0,0) scale(1); }
  30%  { transform: translate3d(0,-12px,0) scale(1.08); }
  55%  { transform: translate3d(0,-7px,0) scale(1.04); }
  100% { transform: translate3d(0,0,0) scale(1); }
}
#btnTap.btn-anim-tap{ animation: btnBounceTapToCenter 0.95s cubic-bezier(.2,1.4,.3,1) 1; }
#btnUke.btn-anim-uke{ animation: btnBounceUkeToCenter 0.95s cubic-bezier(.2,1.4,.3,1) 1; }
#btnTap.btn-anim-both, #btnUke.btn-anim-both{ animation: btnBounceUp 0.85s cubic-bezier(.2,1.4,.3,1) 1; }

/* å³ä¸Šã®å¹ãå‡ºã—/ã‚¿ã‚¤ãƒˆãƒ«ã«è¢«ã‚‰ãªã„ãŸã‚ã€ãƒœã‚¿ãƒ³ã®å½“ãŸã‚Šåˆ¤å®šã¯ãã®ã¾ã¾ */
#btnTap, #btnUke { transform-origin: center; }

/* BUBBLE_TAIL_SIDE_V18: ãƒˆãƒ³ã‚¬ãƒªã‚’å·¦å³ã«åˆ‡ã‚Šæ›¿ãˆï¼ˆçœŸå·¦ï¼çœŸå³ï¼‰ */
.guide-bubble.tail-down::after{
  bottom: -8px;
  left: var(--tail-left, 50%);
  right: auto;
  top: auto;
  transform: translateX(-50%);
  border-width: 8px 8px 0;
  border-style: solid;
  border-color: #fff transparent transparent transparent;
}
.guide-bubble.tail-left::after{
  bottom: auto;
  top: 50%;
  left: -10px;
  right: auto;
  transform: translateY(-50%);
  border-width: 10px 10px 10px 0;
  border-style: solid;
  border-color: transparent #fff transparent transparent;
}
.guide-bubble.tail-right::after{
  bottom: auto;
  top: 50%;
  right: -10px;
  left: auto;
  transform: translateY(-50%);
  border-width: 10px 0 10px 10px;
  border-style: solid;
  border-color: transparent transparent transparent #fff;
}

/* BTN_SMOOTH_V18: ã¬ã‚‹ã£ã¨å‹•ã‹ã™ãŸã‚ã®æœ€é©åŒ– */
.play-btn{ will-change: transform; }
</style>
</head>

<body>

<div class="app-container">
  
  <header class="title-area">
    <h1 class="game-title">ã‚¦ã‚¯ãƒ¬ãƒ¬ã§ã‚ãã¼ã†</h1>
    <span class="sub-title">ãƒªã‚ºãƒ ã«ã‚ã‚ã›ã¦ ã‚¨ãƒ³ã‚¸ãƒ§ã‚¤ï¼</span>
  </header>

  <div class="center-illustration">
    <svg preserveAspectRatio="xMidYMid meet" viewBox="0 0 800 600">
      <g transform="translate(0, 20)"> <ellipse cx="400" cy="500" fill="#cfeeb0" rx="260" ry="60"></ellipse>
        <path d="M360 480 C300 360, 340 260, 330 160 C320 80, 300 40, 280 20 L320 20 C360 60, 380 120, 390 200 C400 300, 380 380, 420 480 Z" fill="#7a4a21"></path>
        <path d="M310 350 Q350 340 380 330" fill="none" stroke="#d8b04c" stroke-width="8"></path>
        <path d="M300 300 Q340 290 370 280" fill="none" stroke="#d8b04c" stroke-width="8"></path>
        <path d="M295 250 Q330 240 360 230" fill="none" stroke="#d8b04c" stroke-width="8"></path>
        
        <g fill="#6aaa1f">
          <path d="M330 40 C180 20, 60 120, 40 200"></path>
          <path d="M330 40 C200 0, 120 40, 90 100"></path>
          <path d="M330 40 C460 20, 580 120, 620 220"></path>
          <path d="M330 40 C480 0, 620 40, 660 120"></path>
          <path d="M330 50 C310 10, 330 0, 350 -20"></path>
        </g>
        <circle cx="340" cy="60" fill="#c8b04a" r="18"></circle>
        <circle cx="365" cy="65" fill="#c8b04a" r="18"></circle>

        <g transform="translate(440 420) rotate(-15)">
          <ellipse cx="50" cy="80" fill="#c68642" rx="45" ry="60"></ellipse>
          <ellipse cx="50" cy="80" fill="#5a3a1a" rx="12" ry="16"></ellipse>
          <rect fill="#b5651d" height="70" width="12" x="44" y="10"></rect>
          <rect fill="#d79a3a" height="20" rx="5" width="40" x="30" y="-20"></rect>
          <line stroke="#ffffff" stroke-width="2" x1="48" x2="48" y1="10" y2="150"></line>
          <line stroke="#ffffff" stroke-width="2" x1="52" x2="52" y1="10" y2="150"></line>
        </g>
        
        <g class="notes-burst" transform="translate(480 400)">
           <text x="0" y="0" font-size="40" fill="#333" style="animation: flyNote 2s infinite">â™ª</text>
           <text x="20" y="-20" font-size="30" fill="#333" style="animation: flyNote 2.5s infinite 0.5s">â™«</text>
        </g>
      </g>
      <style>
        @keyframes flyNote {
          0%{ opacity:0; transform: translate(0,0) rotate(0deg); }
          50%{ opacity:1; }
          100%{ opacity:0; transform: translate(30px, -80px) rotate(20deg); }
        }
      </style>
    </svg>
  </div>

  <div class="guide-bubble">
    <div class="bunny">ğŸ°</div>
    <div class="text" id="teacherText">ã©ã£ã¡ã§ ã‚ãã¶ï¼Ÿ</div>
  </div>

  <div class="menu-row">
    <div id="btnTap" class="play-btn btn-tap" onclick="goFlip('game.html?mode=TAP')">
      <span class="btn-icon">ğŸ‘†</span>
      <h2 class="btn-title">ã‚¿ãƒƒãƒ—ã§<br>ã‚ãã¶</h2>
      <span class="btn-desc">ã™ãã«ã‚ãã¹ã‚‹ï¼</span>
    </div>

    <div id="btnUke" class="play-btn btn-uke" onclick="goFlip('ukulele.html')">
      <span class="btn-icon">ğŸ¸</span>
      <h2 class="btn-title">ã‚¦ã‚¯ãƒ¬ãƒ¬ã§<br>ã‚ãã¶</h2>
      <span class="btn-desc">æ¥½å™¨ã‚’ã¤ã‹ã†ã‚ˆ</span>
    </div>
  </div>

</div>
  <div class="ver-badge">v18</div>

<div id="pageFlip"></div>

<div id="landscapeLock">
  <div style="font-size:40px;">ğŸ“±â†”ï¸</div>
  <p style="font-weight:bold;">æ¨ªç”»é¢ã«ã—ã¦ã­</p>
</div>

<script>
// === ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆæ©Ÿèƒ½ã¯å…ƒã®ã¾ã¾ç¶­æŒï¼‰ ===
function setVh(){
  const h = (window.visualViewport ? window.visualViewport.height : window.innerHeight);
  document.documentElement.style.setProperty('--vh', (h*0.01)+'px');
}
window.addEventListener('resize', setVh);
window.addEventListener('orientationchange', ()=>setTimeout(setVh, 250));
setVh();

let __navLock = false;
function goFlip(url){
  if(__navLock) return;
  __navLock = true;
  document.getElementById('pageFlip').classList.add('run');
  setTimeout(()=>{ location.href = url; }, 300);
}
window.addEventListener('pageshow', ()=>{
  __navLock = false;
  document.getElementById('pageFlip').classList.remove('run');
});

(function(){
  function apply(){
    var portrait = window.innerHeight > window.innerWidth;
    document.body.classList.toggle('needLandscape', portrait);
  }
  window.addEventListener('resize', apply);
  window.addEventListener('orientationchange', apply);
  apply();
})();


  
  // BUBBLE_ANCHOR v7: ğŸ°ã›ã‚“ã›ã„ï¼ˆãƒˆãƒƒãƒ—å°‚ç”¨ï¼šå¸¯ã®ä¸­ã«å›ºå®šã—ã¦â€œçµ¶å¯¾ã«ãƒœã‚¿ãƒ³ã«è¢«ã‚‰ãªã„â€ï¼‰
  
  // BUBBLE_ANCHOR v18: ã‚¿ã‚¤ãƒˆãƒ«ã«ã‚‚ãƒœã‚¿ãƒ³ã«ã‚‚è¢«ã‚‰ãªã„ï¼ˆå¸¯ã«å›ºå®šï¼‹å°¾ã ã‘å‹•ã‹ã™ï¼‰
  (function(){
    const bubble  = document.querySelector('.guide-bubble');
    const textEl  = document.getElementById('teacherText');
    const btnTap  = document.getElementById('btnTap');
    const btnUke  = document.getElementById('btnUke');
    const titleArea = document.querySelector('.title-area');
    const subTitle  = document.querySelector('.sub-title');

    if(!bubble || !textEl || !btnTap || !btnUke) return;

    const msgs = [
      { text: "ã©ã£ã¡ã§ ã‚ãã¶ï¼Ÿ", target: "center" },
      { text: "ã‚¿ãƒƒãƒ—ã§ ã™ã ã‚ãã¹ã‚‹ã‚ˆï¼", target: "tap" },
      { text: "HITã—ãŸã‚‰ ãŠã¨ãŒ ãªã‚‹ã‚ˆâ™ª", target: "tap" },
      { text: "ã‚¦ã‚¯ãƒ¬ãƒ¬ãŒ ã‚ã‚‹ãªã‚‰ ã“ã£ã¡ï¼", target: "uke" }
    ];

    let cur = 0;

    function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

    function clearHints(){
      btnTap.classList.remove('hint');
      btnUke.classList.remove('hint');
    }
    function setHint(t){
      clearHints();
      if(t === "tap") btnTap.classList.add('hint');
      if(t === "uke") btnUke.classList.add('hint');
    }

    function playBtnAnim(target){
      // WAAPIã§â€œæ´¾æ‰‹ã«ãƒŒãƒ«ãƒƒâ€ã¨ï¼ˆtransformç«¶åˆã‚’å›é¿ï¼‰
      function run(el, keyframes){
        if(!el) return;
        // èµ°ã£ã¦ã‚‹ã‚¢ãƒ‹ãƒ¡ã¯æ­¢ã‚ã‚‹
        try{ el.getAnimations().forEach(a=>a.cancel()); }catch(e){}
        el.animate(keyframes, {
          duration: 950,
          easing: 'cubic-bezier(0.18, 1.35, 0.22, 1)',
          fill: 'none'
        });
      }

      const kTap = [
        { transform: 'translate3d(0,0,0) scale(1) rotate(0deg)', offset: 0 },
        { transform: 'translate3d(48px,-18px,0) scale(1.16) rotate(-1.8deg)', offset: 0.36 },
        { transform: 'translate3d(22px,-10px,0) scale(1.08) rotate(0.8deg)',  offset: 0.64 },
        { transform: 'translate3d(0,0,0) scale(1) rotate(0deg)', offset: 1 }
      ];
      const kUke = [
        { transform: 'translate3d(0,0,0) scale(1) rotate(0deg)', offset: 0 },
        { transform: 'translate3d(-48px,-18px,0) scale(1.16) rotate(1.8deg)', offset: 0.36 },
        { transform: 'translate3d(-22px,-10px,0) scale(1.08) rotate(-0.8deg)', offset: 0.64 },
        { transform: 'translate3d(0,0,0) scale(1) rotate(0deg)', offset: 1 }
      ];
      const kBoth = [
        { transform: 'translate3d(0,0,0) scale(1) rotate(0deg)', offset: 0 },
        { transform: 'translate3d(0,-14px,0) scale(1.12) rotate(0deg)', offset: 0.40 },
        { transform: 'translate3d(0,-8px,0) scale(1.06) rotate(0deg)', offset: 0.70 },
        { transform: 'translate3d(0,0,0) scale(1) rotate(0deg)', offset: 1 }
      ];

      if(target === "tap"){
        run(btnTap, kTap);
      }else if(target === "uke"){
        run(btnUke, kUke);
      }else{
        run(btnTap, kBoth);
        run(btnUke, kBoth);
      }
    }
      // ä¸€æ—¦ãƒªã‚»ãƒƒãƒˆ
      btnTap.classList.remove('btn-anim-tap','btn-anim-both');
      btnUke.classList.remove('btn-anim-uke','btn-anim-both');

      if(target === "tap"){
        fire(btnTap, 'btn-anim-tap');
      }else if(target === "uke"){
        fire(btnUke, 'btn-anim-uke');
      }else{
        // center
        fire(btnTap, 'btn-anim-both');
        fire(btnUke, 'btn-anim-both');
      }
    }

    function computeLimits(){
      // ä¸Šï¼šã‚¿ã‚¤ãƒˆãƒ«/ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ã®ä¸‹ï¼ˆçµ¶å¯¾ã«ã‚¿ã‚¤ãƒˆãƒ«ã¸è¡Œã‹ã›ãªã„ï¼‰
      let topLimit = 12;
      if(titleArea){
        const r = titleArea.getBoundingClientRect();
        topLimit = Math.max(topLimit, r.bottom + 10);
      }
      if(subTitle){
        const r = subTitle.getBoundingClientRect();
        topLimit = Math.max(topLimit, r.bottom + 10);
      }

      // ä¸‹ï¼šãƒœã‚¿ãƒ³ä¸Šç«¯ã‚ˆã‚Šä¸Šï¼ˆçµ¶å¯¾ã«ãƒœã‚¿ãƒ³ã¸è¢«ã›ãªã„ï¼‰
      const rt = btnTap.getBoundingClientRect();
      const ru = btnUke.getBoundingClientRect();
      let bottomLimit = Math.min(rt.top, ru.top) - 10;

      // å¿µã®ãŸã‚ï¼ˆæ¥µç«¯ã«ç‹­ã„å ´åˆï¼‰
      bottomLimit = Math.max(bottomLimit, topLimit + 18);

      return { topLimit, bottomLimit };
    }

    function measureAtScale1(){
      bubble.style.transform = 'translate(-50%, 0) scale(1)';
      const r = bubble.getBoundingClientRect();
      return { w:r.width, h:r.height };
    }

    function layout(target){
      setHint(target);

      const { topLimit, bottomLimit } = computeLimits();
      const availH = Math.max(1, bottomLimit - topLimit);

      const m = measureAtScale1();
      let scale = 1;
      if(m.h > availH){
        // ä¸‹é™ãªã—ã§å¿…ãšå…¥ã‚Œã‚‹ï¼ˆãŸã ã—å°ã•ã™ãã‚’é˜²ããŸã‚ 0.46 ã¾ã§ï¼‰
        scale = clamp(availH / m.h, 0.46, 1);
      }

      const w = m.w * scale;
      const h = m.h * scale;

      // X ã¯å¸¸ã«ä¸­å¤®ã€‚ç”»é¢ç«¯ã§åˆ‡ã‚Œãªã„ã‚ˆã†ã«ã‚¯ãƒ©ãƒ³ãƒ—ã€‚
      const x0 = window.innerWidth * 0.5;
      const x  = clamp(x0, 12 + w/2, window.innerWidth - 12 - w/2);

      // Y ã¯ â€œå¸¯â€ ã®ä¸­å¤®ã«å›ºå®šï¼ˆå®‰å®šã—ã¦è¦‹ãˆã‚‹ï¼‰
      let y = topLimit + (availH - h) / 2;
      y = clamp(y, topLimit, bottomLimit - h);

      bubble.style.left = x + 'px';
      bubble.style.top  = y + 'px';
      bubble.style.transform = 'translate(-50%, 0) scale(' + scale.toFixed(3) + ')';
      bubble.classList.remove('tail-up'); // å¸¸ã«ä¸‹å‘ãï¼ˆãƒœã‚¿ãƒ³æ–¹å‘ï¼‰

            // ãƒˆãƒ³ã‚¬ãƒªã¯â€œçœŸå·¦ï¼çœŸå³â€ã«åˆ‡ã‚Šæ›¿ãˆï¼ˆcenterã¯ä¸‹ï¼‰
      bubble.classList.remove('tail-left','tail-right','tail-down');
      if(target === "tap"){
        bubble.classList.add('tail-left');
      }else if(target === "uke"){
        bubble.classList.add('tail-right');
      }else{
        bubble.classList.add('tail-down');
        bubble.style.setProperty('--tail-left', (w * 0.50) + 'px');
      }

      // ã‚³ãƒ¡ãƒ³ãƒˆã«åˆã‚ã›ã¦ãƒœã‚¿ãƒ³ã‚’â€œæ´¾æ‰‹ã«ãƒŒãƒ«ãƒƒâ€ã¨å‹•ã‹ã™
      playBtnAnim(target);
}

    function show(i){
      const msg = msgs[i];
      bubble.classList.add('fade');
      setTimeout(()=>{
        textEl.textContent = msg.text;
        requestAnimationFrame(()=>{
          layout(msg.target);
          bubble.classList.remove('fade');
        });
      }, 160);
    }

    function relayout(){
      layout(msgs[cur].target);
    }

    // åˆæœŸé…ç½®
    requestAnimationFrame(()=>layout(msgs[0].target));

    window.addEventListener('resize', relayout);
    window.addEventListener('orientationchange', ()=>setTimeout(relayout, 120));
    if(window.visualViewport){
      window.visualViewport.addEventListener('resize', relayout);
      window.visualViewport.addEventListener('scroll', relayout);
    }

    setInterval(()=>{
      cur = (cur + 1) % msgs.length;
      show(cur);
    }, 2600);
  })();

;

</script>

</body>
</html>